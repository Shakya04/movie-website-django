
import joblib
import os
from model_log_reg import Logistic_Regression as lr
from sklearn.feature_extraction.text import TfidfVectorizer

def feature_extraction(text):
    os.chdir('C:\\Users\\gshak\\PycharmProjects\\pythonProject\\seventh_project\\movie_site\\models')
    tf = joblib.load('tfidf.joblib')
    vec = TfidfVectorizer(min_df=0.0015, ngram_range=(1, 3), vocabulary=tf.vocabulary_)
    text_transform = vec.fit_transform(text)
    return text_transform.toarray()

def log_model(text):
    text_array = feature_extraction(text)
    os.chdir('C:\\Users\\gshak\\PycharmProjects\\pythonProject\\seventh_project\\movie_site\\models')
    saved_model = joblib.load('movie-review-sentiment.joblib')
    score, sentiment = saved_model.predict(text_array)
    if sentiment == 0 and score < 0.1:
        return "Negative sentiment", 1
    elif sentiment == 0 and score > 0.1 and score <= 0.2:
        return "Negative sentiment", 2
    elif sentiment == 0 and score > 0.2 and score <= 0.3:
        return "Negative sentiment", 3
    elif sentiment == 0 and score > 0.3 and score <= 0.4:
        return "Negative sentiment", 4
    elif sentiment == 0 and score > 0.4 and score <= 0.5:
        return "Negative sentiment", 5
    elif sentiment == 1 and score > 0.5 and score <= 0.6:
        return "Positive sentiment", 6
    elif sentiment == 1 and score > 0.6 and score <= 0.7:
        return "Positive sentiment", 7
    elif sentiment == 1 and score > 0.7 and score <= 0.8:
        return "Positive sentiment", 8
    elif sentiment == 1 and score > 0.8 and score <= 0.9:
        return "Positive sentiment", 9
    else:
        return "Positive sentiment", 10
